---
nginx_sites:
  ssl_reverse_proxy:
    - listen 443 ssl
    - ssl_certificate wildcard.tsuru.paas.alphagov.co.uk.site.chain.crt
    - ssl_certificate_key wildcard.tsuru.paas.alphagov.co.uk.key
    - server_name {{ domain_name }}
    - location / {
      proxy_pass http://localhost:{{ upstream_port }}/;
      proxy_redirect default;
      proxy_redirect http://$host/ https://$host/;
      proxy_redirect http://$hostname/ https://$host/;
      proxy_read_timeout 900s;
      proxy_connect_timeout 15s;
      proxy_buffering off;
      }
  default:
    - listen 80
    - return 301 https://$host$request_uri
nginx_configs:
  proxy:
    - proxy_set_header Host $http_host
    - proxy_set_header X-Real-IP  $remote_addr
    - proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for
    - proxy_set_header X-Forwarded-Proto https
